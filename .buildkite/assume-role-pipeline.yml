steps:
  # - command: |
  #     aws sts get-caller-identity
  #     echo "Token file: $AWS_WEB_IDENTITY_TOKEN_FILE"
  #     cat "$AWS_WEB_IDENTITY_TOKEN_FILE" | cut -d '.' -f2 | base64 -d | jq .
  #   key: "step1"
  #   label: "Get Caller Identity"
  #   plugins:
  #     - aws-assume-role-with-web-identity#v1.4.0:
  #         role-arn: arn:aws:iam::097340723131:role/buildkite-dahtey-Role
  - label: "Upload to ap-southeast-2 bucket"
    command:
      - echo "hello world" > test1.txt
      - buildkite-agent artifact upload test1.txt
    env:
      BUILDKITE_S3_ACL: "private"
      # BUILDKITE_S3_ACCESS_URL: "https://ap-southeast-2.console.aws.amazon.com/s3/buckets/dahteys-test-bucket?region=ap-southeast-2&bucketType=general&tab=objects"
      BUILDKITE_S3_DEFAULT_REGION: "ap-southeast-2"
      BUILDKITE_ARTIFACT_UPLOAD_DESTINATION: "s3://dahteys-test-bucket/"
    key: "step2"
    # depends_on: step1